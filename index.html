<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff006e">
    <meta name="description" content="Four in a Row - Cyberpunk Watermelon Edition. Play this stunning neon-styled game locally or online with friends!">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Four in a Row - Cyberpunk Watermelon Edition</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23ff3366'/><circle cx='50' cy='50' r='40' fill='%23ff6688'/><text x='50' y='70' font-size='50' text-anchor='middle' fill='white'>üçâ</text></svg>">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- Animated Cyberpunk Background -->
    <div class="cyber-bg">
        <div class="cyber-grid"></div>
        <div class="neon-lines">
            <div class="neon-line" style="top: 20%; width: 150%; animation-delay: 0s;"></div>
            <div class="neon-line" style="top: 40%; width: 120%; animation-delay: 2s;"></div>
            <div class="neon-line" style="top: 60%; width: 180%; animation-delay: 4s;"></div>
            <div class="neon-line" style="top: 80%; width: 140%; animation-delay: 6s;"></div>
        </div>
        <canvas id="particleCanvas"></canvas>
    </div>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="soundToggle" aria-label="Toggle sound">
        <span id="soundIcon">üîä</span>
    </button>

    <!-- Main Game Container -->
    <div class="game-container">
        <h1 class="game-title">
            <span class="title-main">Four in a Row</span>
            <span class="title-sub">üçâ Cyberpunk Watermelon Edition üçâ</span>
        </h1>

        <!-- Mode Selection Modal -->
        <div class="modal active" id="modeModal">
            <div class="modal-content">
                <h2 class="modal-title">Choose Game Mode</h2>
                <div class="mode-grid">
                    <div class="mode-card" data-mode="offline" tabindex="0">
                        <div class="mode-icon">üéÆ</div>
                        <h3>Local Play</h3>
                        <p>Play with a friend on the same device</p>
                    </div>
                    <div class="mode-card" data-mode="online" tabindex="0">
                        <div class="mode-icon">üåê</div>
                        <h3>Online Play</h3>
                        <p>Play with someone anywhere</p>
                    </div>
                </div>
                <div class="button-container">
                    <button class="btn btn-primary" id="continueMode" disabled>Continue</button>
                </div>
            </div>
        </div>

        <!-- Player Setup Modal -->
        <div class="modal" id="setupModal">
            <div class="modal-content">
                <h2 class="modal-title" id="setupTitle">Enter Player Names</h2>
                
                <!-- Offline Setup -->
                <div id="offlineSetup" class="setup-section">
                    <div class="input-group">
                        <label for="player1Name">Player 1 (Red Watermelon üçâ)</label>
                        <input type="text" id="player1Name" placeholder="Enter name..." maxlength="15" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label for="player2Name">Player 2 (Blue Watermelon üçâ)</label>
                        <input type="text" id="player2Name" placeholder="Enter name..." maxlength="15" autocomplete="off">
                    </div>
                    <div class="button-row">
                        <button class="btn btn-primary" id="startOffline">Start Game</button>
                        <button class="btn btn-secondary" id="backFromSetup">Back</button>
                    </div>
                </div>

                <!-- Online Setup -->
                <div id="onlineSetup" class="setup-section">
                    <div class="input-group">
                        <label for="playerNameOnline">Your Name</label>
                        <input type="text" id="playerNameOnline" placeholder="Enter your name..." maxlength="15" autocomplete="off">
                    </div>
                    <div class="online-options">
                        <button class="btn btn-primary" id="createRoom">Create Room</button>
                        <button class="btn btn-secondary" id="joinRoomBtn">Join Room</button>
                    </div>
                    
                    <!-- Room Code Input (for joining) -->
                    <div id="joinRoomSection" class="join-section">
                        <div class="input-group">
                            <label for="roomCodeInput">Room Code</label>
                            <input type="text" id="roomCodeInput" placeholder="Enter 6-digit code" maxlength="6" autocomplete="off">
                        </div>
                        <button class="btn btn-primary" id="confirmJoin">Join Game</button>
                    </div>
                    
                    <!-- Creating Room Status -->
                    <div id="creatingRoomSection" class="creating-section">
                        <div class="room-code-display active">
                            <div class="room-code-label">Room Code</div>
                            <div class="room-code-value" id="roomCodeValue">------</div>
                            <button class="btn btn-secondary" id="copyCode">Copy Code</button>
                        </div>
                        <div class="waiting-message">Waiting for player to join...</div>
                        <div class="loading-spinner"></div>
                    </div>
                    
                    <div class="button-container">
                        <button class="btn btn-secondary" id="backFromOnlineSetup">Back</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Area -->
        <div class="game-area" id="gameArea">
            <!-- Player Info -->
            <div class="player-info">
                <div class="player-card player1" id="player1Card">
                    <div class="player-name" id="p1Name">Player 1</div>
                    <div class="player-disc-preview"></div>
                    <div class="player-score">
                        <span class="score-label">Score:</span>
                        <span class="score-value" id="p1Score">0</span>
                    </div>
                    <div class="player-indicator" id="p1Indicator">Your Turn</div>
                </div>
                
                <div class="game-status">
                    <div class="status-text" id="statusText">Game in Progress</div>
                    <div class="move-timer" id="moveTimer">
                        <span class="timer-label">Time:</span>
                        <span class="timer-value" id="timerValue">0:00</span>
                    </div>
                </div>
                
                <div class="player-card player2" id="player2Card">
                    <div class="player-name" id="p2Name">Player 2</div>
                    <div class="player-disc-preview"></div>
                    <div class="player-score">
                        <span class="score-label">Score:</span>
                        <span class="score-value" id="p2Score">0</span>
                    </div>
                    <div class="player-indicator" id="p2Indicator">Your Turn</div>
                </div>
            </div>

            <!-- Game Board Container -->
            <div class="board-wrapper">
                <div class="board-container">
                    <div class="board" id="gameBoard"></div>
                    <div class="column-indicators" id="columnIndicators"></div>
                </div>
                
                <!-- Move Confirmation (Non-intrusive) -->
                <div class="move-confirm-strip" id="moveConfirm">
                    <span class="move-confirm-text">Drop in column <span id="colNumber">1</span>?</span>
                    <div class="move-confirm-buttons">
                        <button class="confirm-btn confirm-yes" id="confirmMove">‚úì</button>
                        <button class="confirm-btn confirm-no" id="cancelMove">‚úó</button>
                    </div>
                </div>
            </div>

            <!-- Game Controls -->
            <div class="game-controls">
                <button class="control-btn" id="undoBtn" title="Undo last move">
                    <span class="control-icon">‚Ü©Ô∏è</span>
                    <span class="control-text">Undo</span>
                </button>
                <button class="control-btn" id="hintBtn" title="Show hint">
                    <span class="control-icon">üí°</span>
                    <span class="control-text">Hint</span>
                </button>
                <button class="control-btn" id="newGameBtn" title="Start new game">
                    <span class="control-icon">üîÑ</span>
                    <span class="control-text">New</span>
                </button>
                <button class="control-btn" id="quitBtn" title="Quit to menu">
                    <span class="control-icon">üö™</span>
                    <span class="control-text">Menu</span>
                </button>
            </div>
        </div>

        <!-- Win Overlay -->
        <div class="win-overlay" id="winOverlay">
            <div class="win-content">
                <div class="win-animation">
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                </div>
                <div class="win-title" id="winTitle">üéâ Victory! üéâ</div>
                <div class="win-player" id="winPlayer">Player Name</div>
                <div class="win-stats">
                    <div class="stat-item">
                        <span class="stat-label">Moves:</span>
                        <span class="stat-value" id="winMoves">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Time:</span>
                        <span class="stat-value" id="winTime">0:00</span>
                    </div>
                </div>
                <div class="win-buttons">
                    <button class="btn btn-primary" id="rematchBtn">Rematch</button>
                    <button class="btn btn-secondary" id="mainMenuBtn">Main Menu</button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="loading-spinner-large"></div>
                <div class="loading-text" id="loadingText">Connecting...</div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>
    
    <!-- Game Scripts -->
    <script src="sound-manager.js"></script>
    <script src="particles.js"></script>
    <script src="game.js"></script>
    <script src="app.js"></script>
    
    <!-- Service Worker for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }
    </script>
</body>
</html>
